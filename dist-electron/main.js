"use strict";var Qe=Object.defineProperty;var Ke=(h,c,s)=>c in h?Qe(h,c,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[c]=s;var y=(h,c,s)=>Ke(h,typeof c!="symbol"?c+"":c,s);const f=require("electron"),l=require("path"),Xe=require("child_process"),R=require("os"),m=require("fs"),Ze=require("util"),Me=require("events"),et=require("http"),tt=require("https");function rt(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var F={exports:{}},W={exports:{}},le;function Te(){return le||(le=1,function(h){let c={};try{c=require("electron")}catch{}c.ipcRenderer&&s(c),h.exports=s;function s({contextBridge:i,ipcRenderer:o}){if(!o)return;o.on("__ELECTRON_LOG_IPC__",(r,e)=>{window.postMessage({cmd:"message",...e})}),o.invoke("__ELECTRON_LOG__",{cmd:"getOptions"}).catch(r=>console.error(new Error(`electron-log isn't initialized in the main process. Please call log.initialize() before. ${r.message}`)));const t={sendToMain(r){try{o.send("__ELECTRON_LOG__",r)}catch(e){console.error("electronLog.sendToMain ",e,"data:",r),o.send("__ELECTRON_LOG__",{cmd:"errorHandler",error:{message:e==null?void 0:e.message,stack:e==null?void 0:e.stack},errorName:"sendToMain"})}},log(...r){t.sendToMain({data:r,level:"info"})}};for(const r of["error","warn","info","verbose","debug","silly"])t[r]=(...e)=>t.sendToMain({data:e,level:r});if(i&&process.contextIsolated)try{i.exposeInMainWorld("__electronLog",t)}catch{}typeof window=="object"?window.__electronLog=t:__electronLog=t}}(W)),W.exports}var C={exports:{}},z,ue;function st(){if(ue)return z;ue=1,z=h;function h(c){return Object.defineProperties(s,{defaultLabel:{value:"",writable:!0},labelPadding:{value:!0,writable:!0},maxLabelLength:{value:0,writable:!0},labelLength:{get(){switch(typeof s.labelPadding){case"boolean":return s.labelPadding?s.maxLabelLength:0;case"number":return s.labelPadding;default:return 0}}}});function s(i){s.maxLabelLength=Math.max(s.maxLabelLength,i.length);const o={};for(const t of c.levels)o[t]=(...r)=>c.logData(r,{level:t,scope:i});return o.log=o.info,o}}return z}var q,he;function nt(){if(he)return q;he=1;class h{constructor({processMessage:s}){this.processMessage=s,this.buffer=[],this.enabled=!1,this.begin=this.begin.bind(this),this.commit=this.commit.bind(this),this.reject=this.reject.bind(this)}addMessage(s){this.buffer.push(s)}begin(){this.enabled=[]}commit(){this.enabled=!1,this.buffer.forEach(s=>this.processMessage(s)),this.buffer=[]}reject(){this.enabled=!1,this.buffer=[]}}return q=h,q}var N,de;function Ie(){if(de)return N;de=1;const h=st(),c=nt(),i=class i{constructor({allowUnknownLevel:t=!1,dependencies:r={},errorHandler:e,eventLogger:n,initializeFn:a,isDev:u=!1,levels:d=["error","warn","info","verbose","debug","silly"],logId:g,transportFactories:w={},variables:A}={}){y(this,"dependencies",{});y(this,"errorHandler",null);y(this,"eventLogger",null);y(this,"functions",{});y(this,"hooks",[]);y(this,"isDev",!1);y(this,"levels",null);y(this,"logId",null);y(this,"scope",null);y(this,"transports",{});y(this,"variables",{});this.addLevel=this.addLevel.bind(this),this.create=this.create.bind(this),this.initialize=this.initialize.bind(this),this.logData=this.logData.bind(this),this.processMessage=this.processMessage.bind(this),this.allowUnknownLevel=t,this.buffering=new c(this),this.dependencies=r,this.initializeFn=a,this.isDev=u,this.levels=d,this.logId=g,this.scope=h(this),this.transportFactories=w,this.variables=A||{};for(const P of this.levels)this.addLevel(P,!1);this.log=this.info,this.functions.log=this.log,this.errorHandler=e,e==null||e.setOptions({...r,logFn:this.error}),this.eventLogger=n,n==null||n.setOptions({...r,logger:this});for(const[P,b]of Object.entries(w))this.transports[P]=b(this,r);i.instances[g]=this}static getInstance({logId:t}){return this.instances[t]||this.instances.default}addLevel(t,r=this.levels.length){r!==!1&&this.levels.splice(r,0,t),this[t]=(...e)=>this.logData(e,{level:t}),this.functions[t]=this[t]}catchErrors(t){return this.processMessage({data:["log.catchErrors is deprecated. Use log.errorHandler instead"],level:"warn"},{transports:["console"]}),this.errorHandler.startCatching(t)}create(t){return typeof t=="string"&&(t={logId:t}),new i({dependencies:this.dependencies,errorHandler:this.errorHandler,initializeFn:this.initializeFn,isDev:this.isDev,transportFactories:this.transportFactories,variables:{...this.variables},...t})}compareLevels(t,r,e=this.levels){const n=e.indexOf(t),a=e.indexOf(r);return a===-1||n===-1?!0:a<=n}initialize(t={}){this.initializeFn({logger:this,...this.dependencies,...t})}logData(t,r={}){this.buffering.enabled?this.buffering.addMessage({data:t,date:new Date,...r}):this.processMessage({data:t,...r})}processMessage(t,{transports:r=this.transports}={}){if(t.cmd==="errorHandler"){this.errorHandler.handle(t.error,{errorName:t.errorName,processType:"renderer",showDialog:!!t.showDialog});return}let e=t.level;this.allowUnknownLevel||(e=this.levels.includes(t.level)?t.level:"info");const n={date:new Date,logId:this.logId,...t,level:e,variables:{...this.variables,...t.variables}};for(const[a,u]of this.transportEntries(r))if(!(typeof u!="function"||u.level===!1)&&this.compareLevels(u.level,t.level))try{const d=this.hooks.reduce((g,w)=>g&&w(g,u,a),n);d&&u({...d,data:[...d.data]})}catch(d){this.processInternalErrorFn(d)}}processInternalErrorFn(t){}transportEntries(t=this.transports){return(Array.isArray(t)?t:Object.entries(t)).map(e=>{switch(typeof e){case"string":return this.transports[e]?[e,this.transports[e]]:null;case"function":return[e.name,e];default:return Array.isArray(e)?e:null}}).filter(Boolean)}};y(i,"instances",{});let s=i;return N=s,N}var M,fe;function ot(){if(fe)return M;fe=1;const h=console.error;class c{constructor({logFn:i=null}={}){y(this,"logFn",null);y(this,"onError",null);y(this,"showDialog",!1);y(this,"preventDefault",!0);this.handleError=this.handleError.bind(this),this.handleRejection=this.handleRejection.bind(this),this.startCatching=this.startCatching.bind(this),this.logFn=i}handle(i,{logFn:o=this.logFn,errorName:t="",onError:r=this.onError,showDialog:e=this.showDialog}={}){try{(r==null?void 0:r({error:i,errorName:t,processType:"renderer"}))!==!1&&o({error:i,errorName:t,showDialog:e})}catch{h(i)}}setOptions({logFn:i,onError:o,preventDefault:t,showDialog:r}){typeof i=="function"&&(this.logFn=i),typeof o=="function"&&(this.onError=o),typeof t=="boolean"&&(this.preventDefault=t),typeof r=="boolean"&&(this.showDialog=r)}startCatching({onError:i,showDialog:o}={}){this.isActive||(this.isActive=!0,this.setOptions({onError:i,showDialog:o}),window.addEventListener("error",t=>{var r;this.preventDefault&&((r=t.preventDefault)==null||r.call(t)),this.handleError(t.error||t)}),window.addEventListener("unhandledrejection",t=>{var r;this.preventDefault&&((r=t.preventDefault)==null||r.call(t)),this.handleRejection(t.reason||t)}))}handleError(i){this.handle(i,{errorName:"Unhandled"})}handleRejection(i){const o=i instanceof Error?i:new Error(JSON.stringify(i));this.handle(o,{errorName:"Unhandled rejection"})}}return M=c,M}var T,ge;function D(){if(ge)return T;ge=1,T={transform:h};function h({logger:c,message:s,transport:i,initialData:o=(s==null?void 0:s.data)||[],transforms:t=i==null?void 0:i.transforms}){return t.reduce((r,e)=>typeof e=="function"?e({data:r,logger:c,message:s,transport:i}):r,o)}return T}var I,me;function it(){if(me)return I;me=1;const{transform:h}=D();I=s;const c={error:console.error,warn:console.warn,info:console.info,verbose:console.info,debug:console.debug,silly:console.debug,log:console.log};function s(o){return Object.assign(t,{format:"{h}:{i}:{s}.{ms}{scope} › {text}",transforms:[i],writeFn({message:{level:r,data:e}}){const n=c[r]||c.info;setTimeout(()=>n(...e))}});function t(r){t.writeFn({message:{...r,data:h({logger:o,message:r,transport:t})}})}}function i({data:o=[],logger:t={},message:r={},transport:e={}}){if(typeof e.format=="function")return e.format({data:o,level:(r==null?void 0:r.level)||"info",logger:t,message:r,transport:e});if(typeof e.format!="string")return o;o.unshift(e.format),typeof o[1]=="string"&&o[1].match(/%[1cdfiOos]/)&&(o=[`${o[0]}${o[1]}`,...o.slice(2)]);const n=r.date||new Date;return o[0]=o[0].replace(/\{(\w+)}/g,(a,u)=>{var d,g;switch(u){case"level":return r.level;case"logId":return r.logId;case"scope":{const w=r.scope||((d=t.scope)==null?void 0:d.defaultLabel);return w?` (${w})`:""}case"text":return"";case"y":return n.getFullYear().toString(10);case"m":return(n.getMonth()+1).toString(10).padStart(2,"0");case"d":return n.getDate().toString(10).padStart(2,"0");case"h":return n.getHours().toString(10).padStart(2,"0");case"i":return n.getMinutes().toString(10).padStart(2,"0");case"s":return n.getSeconds().toString(10).padStart(2,"0");case"ms":return n.getMilliseconds().toString(10).padStart(3,"0");case"iso":return n.toISOString();default:return((g=r.variables)==null?void 0:g[u])||a}}).trim(),o}return I}var U,ye;function at(){if(ye)return U;ye=1;const{transform:h}=D();U=s;const c=new Set([Promise,WeakMap,WeakSet]);function s(t){return Object.assign(r,{depth:5,transforms:[o]});function r(e){if(!window.__electronLog){t.processMessage({data:["electron-log: logger isn't initialized in the main process"],level:"error"},{transports:["console"]});return}try{const n=h({initialData:e,logger:t,message:e,transport:r});__electronLog.sendToMain(n)}catch(n){t.transports.console({data:["electronLog.transports.ipc",n,"data:",e.data],level:"error"})}}}function i(t){return Object(t)!==t}function o({data:t,depth:r,seen:e=new WeakSet,transport:n={}}={}){const a=r||n.depth||5;return e.has(t)?"[Circular]":a<1?i(t)?t:Array.isArray(t)?"[Array]":`[${typeof t}]`:["function","symbol"].includes(typeof t)?t.toString():i(t)?t:c.has(t.constructor)?`[${t.constructor.name}]`:Array.isArray(t)?t.map(u=>o({data:u,depth:a-1,seen:e})):t instanceof Date?t.toISOString():t instanceof Error?t.stack:t instanceof Map?new Map(Array.from(t).map(([u,d])=>[o({data:u,depth:a-1,seen:e}),o({data:d,depth:a-1,seen:e})])):t instanceof Set?new Set(Array.from(t).map(u=>o({data:u,depth:a-1,seen:e}))):(e.add(t),Object.fromEntries(Object.entries(t).map(([u,d])=>[u,o({data:d,depth:a-1,seen:e})])))}return U}var we;function ct(){return we||(we=1,function(h){const c=Ie(),s=ot(),i=it(),o=at();h.exports=t(),h.exports.Logger=c,h.exports.default=h.exports;function t(){const r=new c({allowUnknownLevel:!0,errorHandler:new s,initializeFn:()=>{},logId:"default",transportFactories:{console:i,ipc:o},variables:{processType:"renderer"}});return r.errorHandler.setOptions({logFn({error:e,errorName:n,showDialog:a}){r.transports.console({data:[n,e].filter(Boolean),level:"error"}),r.transports.ipc({cmd:"errorHandler",error:{cause:e==null?void 0:e.cause,code:e==null?void 0:e.code,name:e==null?void 0:e.name,message:e==null?void 0:e.message,stack:e==null?void 0:e.stack},errorName:n,logId:r.logId,showDialog:a})}}),typeof window=="object"&&window.addEventListener("message",e=>{const{cmd:n,logId:a,...u}=e.data||{},d=c.getInstance({logId:a});n==="message"&&d.processMessage(u,{transports:["console"]})}),new Proxy(r,{get(e,n){return typeof e[n]<"u"?e[n]:(...a)=>r.logData(a,{level:n})}})}}(C)),C.exports}var B,be;function pt(){if(be)return B;be=1;const h=m,c=l;B={findAndReadPackageJson:s,tryReadJsonAt:i};function s(){return i(r())||i(t())||i(process.resourcesPath,"app.asar")||i(process.resourcesPath,"app")||i(process.cwd())||{name:void 0,version:void 0}}function i(...e){if(e[0])try{const n=c.join(...e),a=o("package.json",n);if(!a)return;const u=JSON.parse(h.readFileSync(a,"utf8")),d=(u==null?void 0:u.productName)||(u==null?void 0:u.name);return!d||d.toLowerCase()==="electron"?void 0:d?{name:d,version:u==null?void 0:u.version}:void 0}catch{return}}function o(e,n){let a=n;for(;;){const u=c.parse(a),d=u.root,g=u.dir;if(h.existsSync(c.join(a,e)))return c.resolve(c.join(a,e));if(a===d)return null;a=g}}function t(){const e=process.argv.filter(a=>a.indexOf("--user-data-dir=")===0);return e.length===0||typeof e[0]!="string"?null:e[0].replace("--user-data-dir=","")}function r(){var e;try{return(e=require.main)==null?void 0:e.filename}catch{return}}return B}var J,Pe;function Ue(){if(Pe)return J;Pe=1;const h=Xe,c=R,s=l,i=pt();class o{constructor(){y(this,"appName");y(this,"appPackageJson");y(this,"platform",process.platform)}getAppLogPath(r=this.getAppName()){return this.platform==="darwin"?s.join(this.getSystemPathHome(),"Library/Logs",r):s.join(this.getAppUserDataPath(r),"logs")}getAppName(){var e;const r=this.appName||((e=this.getAppPackageJson())==null?void 0:e.name);if(!r)throw new Error("electron-log can't determine the app name. It tried these methods:\n1. Use `electron.app.name`\n2. Use productName or name from the nearest package.json`\nYou can also set it through log.transports.file.setAppName()");return r}getAppPackageJson(){return typeof this.appPackageJson!="object"&&(this.appPackageJson=i.findAndReadPackageJson()),this.appPackageJson}getAppUserDataPath(r=this.getAppName()){return r?s.join(this.getSystemPathAppData(),r):void 0}getAppVersion(){var r;return(r=this.getAppPackageJson())==null?void 0:r.version}getElectronLogPath(){return this.getAppLogPath()}getMacOsVersion(){const r=Number(c.release().split(".")[0]);return r<=19?`10.${r-4}`:r-9}getOsVersion(){let r=c.type().replace("_"," "),e=c.release();return r==="Darwin"&&(r="macOS",e=this.getMacOsVersion()),`${r} ${e}`}getPathVariables(){const r=this.getAppName(),e=this.getAppVersion(),n=this;return{appData:this.getSystemPathAppData(),appName:r,appVersion:e,get electronDefaultDir(){return n.getElectronLogPath()},home:this.getSystemPathHome(),libraryDefaultDir:this.getAppLogPath(r),libraryTemplate:this.getAppLogPath("{appName}"),temp:this.getSystemPathTemp(),userData:this.getAppUserDataPath(r)}}getSystemPathAppData(){const r=this.getSystemPathHome();switch(this.platform){case"darwin":return s.join(r,"Library/Application Support");case"win32":return process.env.APPDATA||s.join(r,"AppData/Roaming");default:return process.env.XDG_CONFIG_HOME||s.join(r,".config")}}getSystemPathHome(){var r;return((r=c.homedir)==null?void 0:r.call(c))||process.env.HOME}getSystemPathTemp(){return c.tmpdir()}getVersions(){return{app:`${this.getAppName()} ${this.getAppVersion()}`,electron:void 0,os:this.getOsVersion()}}isDev(){return process.env.NODE_ENV==="development"||process.env.ELECTRON_IS_DEV==="1"}isElectron(){return!!process.versions.electron}onAppEvent(r,e){}onAppReady(r){r()}onEveryWebContentsEvent(r,e){}onIpc(r,e){}onIpcInvoke(r,e){}openUrl(r,e=console.error){const a={darwin:"open",win32:"start",linux:"xdg-open"}[process.platform]||"xdg-open";h.exec(`${a} ${r}`,{},u=>{u&&e(u)})}setAppName(r){this.appName=r}setPlatform(r){this.platform=r}setPreloadFileForSessions({filePath:r,includeFutureSession:e=!0,getSessions:n=()=>[]}){}sendIpc(r,e){}showErrorBox(r,e){}}return J=o,J}var H,ve;function lt(){if(ve)return H;ve=1;const h=l,c=Ue();class s extends c{constructor({electron:t}={}){super();y(this,"electron");this.electron=t}getAppName(){var r,e;let t;try{t=this.appName||((r=this.electron.app)==null?void 0:r.name)||((e=this.electron.app)==null?void 0:e.getName())}catch{}return t||super.getAppName()}getAppUserDataPath(t){return this.getPath("userData")||super.getAppUserDataPath(t)}getAppVersion(){var r;let t;try{t=(r=this.electron.app)==null?void 0:r.getVersion()}catch{}return t||super.getAppVersion()}getElectronLogPath(){return this.getPath("logs")||super.getElectronLogPath()}getPath(t){var r;try{return(r=this.electron.app)==null?void 0:r.getPath(t)}catch{return}}getVersions(){return{app:`${this.getAppName()} ${this.getAppVersion()}`,electron:`Electron ${process.versions.electron}`,os:this.getOsVersion()}}getSystemPathAppData(){return this.getPath("appData")||super.getSystemPathAppData()}isDev(){var t;return((t=this.electron.app)==null?void 0:t.isPackaged)!==void 0?!this.electron.app.isPackaged:typeof process.execPath=="string"?h.basename(process.execPath).toLowerCase().startsWith("electron"):super.isDev()}onAppEvent(t,r){var e;return(e=this.electron.app)==null||e.on(t,r),()=>{var n;(n=this.electron.app)==null||n.off(t,r)}}onAppReady(t){var r,e,n;(r=this.electron.app)!=null&&r.isReady()?t():(e=this.electron.app)!=null&&e.once?(n=this.electron.app)==null||n.once("ready",t):t()}onEveryWebContentsEvent(t,r){var n,a,u;return(a=(n=this.electron.webContents)==null?void 0:n.getAllWebContents())==null||a.forEach(d=>{d.on(t,r)}),(u=this.electron.app)==null||u.on("web-contents-created",e),()=>{var d,g;(d=this.electron.webContents)==null||d.getAllWebContents().forEach(w=>{w.off(t,r)}),(g=this.electron.app)==null||g.off("web-contents-created",e)};function e(d,g){g.on(t,r)}}onIpc(t,r){var e;(e=this.electron.ipcMain)==null||e.on(t,r)}onIpcInvoke(t,r){var e,n;(n=(e=this.electron.ipcMain)==null?void 0:e.handle)==null||n.call(e,t,r)}openUrl(t,r=console.error){var e;(e=this.electron.shell)==null||e.openExternal(t).catch(r)}setPreloadFileForSessions({filePath:t,includeFutureSession:r=!0,getSessions:e=()=>{var n;return[(n=this.electron.session)==null?void 0:n.defaultSession]}}){for(const a of e().filter(Boolean))n(a);r&&this.onAppEvent("session-created",a=>{n(a)});function n(a){typeof a.registerPreloadScript=="function"?a.registerPreloadScript({filePath:t,id:"electron-log-preload",type:"frame"}):a.setPreloads([...a.getPreloads(),t])}}sendIpc(t,r){var e,n;(n=(e=this.electron.BrowserWindow)==null?void 0:e.getAllWindows())==null||n.forEach(a=>{var u,d;((u=a.webContents)==null?void 0:u.isDestroyed())===!1&&((d=a.webContents)==null?void 0:d.isCrashed())===!1&&a.webContents.send(t,r)})}showErrorBox(t,r){var e;(e=this.electron.dialog)==null||e.showErrorBox(t,r)}}return H=s,H}var V,Se;function ut(){if(Se)return V;Se=1;const h=m,c=R,s=l,i=Te();V={initialize({externalApi:r,getSessions:e,includeFutureSession:n,logger:a,preload:u=!0,spyRendererConsole:d=!1}){r.onAppReady(()=>{try{u&&o({externalApi:r,getSessions:e,includeFutureSession:n,preloadOption:u}),d&&t({externalApi:r,logger:a})}catch(g){a.warn(g)}})}};function o({externalApi:r,getSessions:e,includeFutureSession:n,preloadOption:a}){let u=typeof a=="string"?a:void 0;try{u=s.resolve(__dirname,"../renderer/electron-log-preload.js")}catch{}if(!u||!h.existsSync(u)){u=s.join(r.getAppUserDataPath()||c.tmpdir(),"electron-log-preload.js");const d=`
      try {
        (${i.toString()})(require('electron'));
      } catch(e) {
        console.error(e);
      }
    `;h.writeFileSync(u,d,"utf8")}r.setPreloadFileForSessions({filePath:u,includeFutureSession:n,getSessions:e})}function t({externalApi:r,logger:e}){const n=["debug","info","warn","error"];r.onEveryWebContentsEvent("console-message",(a,u,d)=>{e.processMessage({data:[d],level:n[u],variables:{processType:"renderer"}})})}return V}var G,$e;function ht(){if($e)return G;$e=1;class h{constructor({externalApi:i,logFn:o=void 0,onError:t=void 0,showDialog:r=void 0}={}){y(this,"externalApi");y(this,"isActive",!1);y(this,"logFn");y(this,"onError");y(this,"showDialog",!0);this.createIssue=this.createIssue.bind(this),this.handleError=this.handleError.bind(this),this.handleRejection=this.handleRejection.bind(this),this.setOptions({externalApi:i,logFn:o,onError:t,showDialog:r}),this.startCatching=this.startCatching.bind(this),this.stopCatching=this.stopCatching.bind(this)}handle(i,{logFn:o=this.logFn,onError:t=this.onError,processType:r="browser",showDialog:e=this.showDialog,errorName:n=""}={}){var a;i=c(i);try{if(typeof t=="function"){const u=((a=this.externalApi)==null?void 0:a.getVersions())||{},d=this.createIssue;if(t({createIssue:d,error:i,errorName:n,processType:r,versions:u})===!1)return}n?o(n,i):o(i),e&&!n.includes("rejection")&&this.externalApi&&this.externalApi.showErrorBox(`A JavaScript error occurred in the ${r} process`,i.stack)}catch{console.error(i)}}setOptions({externalApi:i,logFn:o,onError:t,showDialog:r}){typeof i=="object"&&(this.externalApi=i),typeof o=="function"&&(this.logFn=o),typeof t=="function"&&(this.onError=t),typeof r=="boolean"&&(this.showDialog=r)}startCatching({onError:i,showDialog:o}={}){this.isActive||(this.isActive=!0,this.setOptions({onError:i,showDialog:o}),process.on("uncaughtException",this.handleError),process.on("unhandledRejection",this.handleRejection))}stopCatching(){this.isActive=!1,process.removeListener("uncaughtException",this.handleError),process.removeListener("unhandledRejection",this.handleRejection)}createIssue(i,o){var t;(t=this.externalApi)==null||t.openUrl(`${i}?${new URLSearchParams(o).toString()}`)}handleError(i){this.handle(i,{errorName:"Unhandled"})}handleRejection(i){const o=i instanceof Error?i:new Error(JSON.stringify(i));this.handle(o,{errorName:"Unhandled rejection"})}}function c(s){if(s instanceof Error)return s;if(s&&typeof s=="object"){if(s.message)return Object.assign(new Error(s.message),s);try{return new Error(JSON.stringify(s))}catch(i){return new Error(`Couldn't normalize error ${String(s)}: ${i}`)}}return new Error(`Can't normalize error ${String(s)}`)}return G=h,G}var Y,xe;function dt(){if(xe)return Y;xe=1;class h{constructor(s={}){y(this,"disposers",[]);y(this,"format","{eventSource}#{eventName}:");y(this,"formatters",{app:{"certificate-error":({args:s})=>this.arrayToObject(s.slice(1,4),["url","error","certificate"]),"child-process-gone":({args:s})=>s.length===1?s[0]:s,"render-process-gone":({args:[s,i]})=>i&&typeof i=="object"?{...i,...this.getWebContentsDetails(s)}:[]},webContents:{"console-message":({args:[s,i,o,t]})=>{if(!(s<3))return{message:i,source:`${t}:${o}`}},"did-fail-load":({args:s})=>this.arrayToObject(s,["errorCode","errorDescription","validatedURL","isMainFrame","frameProcessId","frameRoutingId"]),"did-fail-provisional-load":({args:s})=>this.arrayToObject(s,["errorCode","errorDescription","validatedURL","isMainFrame","frameProcessId","frameRoutingId"]),"plugin-crashed":({args:s})=>this.arrayToObject(s,["name","version"]),"preload-error":({args:s})=>this.arrayToObject(s,["preloadPath","error"])}});y(this,"events",{app:{"certificate-error":!0,"child-process-gone":!0,"render-process-gone":!0},webContents:{"did-fail-load":!0,"did-fail-provisional-load":!0,"plugin-crashed":!0,"preload-error":!0,unresponsive:!0}});y(this,"externalApi");y(this,"level","error");y(this,"scope","");this.setOptions(s)}setOptions({events:s,externalApi:i,level:o,logger:t,format:r,formatters:e,scope:n}){typeof s=="object"&&(this.events=s),typeof i=="object"&&(this.externalApi=i),typeof o=="string"&&(this.level=o),typeof t=="object"&&(this.logger=t),(typeof r=="string"||typeof r=="function")&&(this.format=r),typeof e=="object"&&(this.formatters=e),typeof n=="string"&&(this.scope=n)}startLogging(s={}){this.setOptions(s),this.disposeListeners();for(const i of this.getEventNames(this.events.app))this.disposers.push(this.externalApi.onAppEvent(i,(...o)=>{this.handleEvent({eventSource:"app",eventName:i,handlerArgs:o})}));for(const i of this.getEventNames(this.events.webContents))this.disposers.push(this.externalApi.onEveryWebContentsEvent(i,(...o)=>{this.handleEvent({eventSource:"webContents",eventName:i,handlerArgs:o})}))}stopLogging(){this.disposeListeners()}arrayToObject(s,i){const o={};return i.forEach((t,r)=>{o[t]=s[r]}),s.length>i.length&&(o.unknownArgs=s.slice(i.length)),o}disposeListeners(){this.disposers.forEach(s=>s()),this.disposers=[]}formatEventLog({eventName:s,eventSource:i,handlerArgs:o}){var d;const[t,...r]=o;if(typeof this.format=="function")return this.format({args:r,event:t,eventName:s,eventSource:i});const e=(d=this.formatters[i])==null?void 0:d[s];let n=r;if(typeof e=="function"&&(n=e({args:r,event:t,eventName:s,eventSource:i})),!n)return;const a={};return Array.isArray(n)?a.args=n:typeof n=="object"&&Object.assign(a,n),i==="webContents"&&Object.assign(a,this.getWebContentsDetails(t==null?void 0:t.sender)),[this.format.replace("{eventSource}",i==="app"?"App":"WebContents").replace("{eventName}",s),a]}getEventNames(s){return!s||typeof s!="object"?[]:Object.entries(s).filter(([i,o])=>o).map(([i])=>i)}getWebContentsDetails(s){if(!(s!=null&&s.loadURL))return{};try{return{webContents:{id:s.id,url:s.getURL()}}}catch{return{}}}handleEvent({eventName:s,eventSource:i,handlerArgs:o}){var r;const t=this.formatEventLog({eventName:s,eventSource:i,handlerArgs:o});if(t){const e=this.scope?this.logger.scope(this.scope):this.logger;(r=e==null?void 0:e[this.level])==null||r.call(e,...t)}}}return Y=h,Y}var Q,je;function Be(){if(je)return Q;je=1;const{transform:h}=D();Q={concatFirstStringElements:c,formatScope:i,formatText:t,formatVariables:o,timeZoneFromOffset:s,format({message:r,logger:e,transport:n,data:a=r==null?void 0:r.data}){switch(typeof n.format){case"string":return h({message:r,logger:e,transforms:[o,i,t],transport:n,initialData:[n.format,...a]});case"function":return n.format({data:a,level:(r==null?void 0:r.level)||"info",logger:e,message:r,transport:n});default:return a}}};function c({data:r}){return typeof r[0]!="string"||typeof r[1]!="string"||r[0].match(/%[1cdfiOos]/)?r:[`${r[0]} ${r[1]}`,...r.slice(2)]}function s(r){const e=Math.abs(r),n=r>0?"-":"+",a=Math.floor(e/60).toString().padStart(2,"0"),u=(e%60).toString().padStart(2,"0");return`${n}${a}:${u}`}function i({data:r,logger:e,message:n}){const{defaultLabel:a,labelLength:u}=(e==null?void 0:e.scope)||{},d=r[0];let g=n.scope;g||(g=a);let w;return g===""?w=u>0?"".padEnd(u+3):"":typeof g=="string"?w=` (${g})`.padEnd(u+3):w="",r[0]=d.replace("{scope}",w),r}function o({data:r,message:e}){let n=r[0];if(typeof n!="string")return r;n=n.replace("{level}]",`${e.level}]`.padEnd(6," "));const a=e.date||new Date;return r[0]=n.replace(/\{(\w+)}/g,(u,d)=>{var g;switch(d){case"level":return e.level||"info";case"logId":return e.logId;case"y":return a.getFullYear().toString(10);case"m":return(a.getMonth()+1).toString(10).padStart(2,"0");case"d":return a.getDate().toString(10).padStart(2,"0");case"h":return a.getHours().toString(10).padStart(2,"0");case"i":return a.getMinutes().toString(10).padStart(2,"0");case"s":return a.getSeconds().toString(10).padStart(2,"0");case"ms":return a.getMilliseconds().toString(10).padStart(3,"0");case"z":return s(a.getTimezoneOffset());case"iso":return a.toISOString();default:return((g=e.variables)==null?void 0:g[d])||u}}).trim(),r}function t({data:r}){const e=r[0];if(typeof e!="string")return r;if(e.lastIndexOf("{text}")===e.length-6)return r[0]=e.replace(/\s?{text}/,""),r[0]===""&&r.shift(),r;const a=e.split("{text}");let u=[];return a[0]!==""&&u.push(a[0]),u=u.concat(r.slice(1)),a[1]!==""&&u.push(a[1]),u}return Q}var K={exports:{}},Ee;function _(){return Ee||(Ee=1,function(h){const c=Ze;h.exports={serialize:i,maxDepth({data:o,transport:t,depth:r=(t==null?void 0:t.depth)??6}){if(!o)return o;if(r<1)return Array.isArray(o)?"[array]":typeof o=="object"&&o?"[object]":o;if(Array.isArray(o))return o.map(n=>h.exports.maxDepth({data:n,depth:r-1}));if(typeof o!="object"||o&&typeof o.toISOString=="function")return o;if(o===null)return null;if(o instanceof Error)return o;const e={};for(const n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=h.exports.maxDepth({data:o[n],depth:r-1}));return e},toJSON({data:o}){return JSON.parse(JSON.stringify(o,s()))},toString({data:o,transport:t}){const r=(t==null?void 0:t.inspectOptions)||{},e=o.map(n=>{if(n!==void 0)try{const a=JSON.stringify(n,s(),"  ");return a===void 0?void 0:JSON.parse(a)}catch{return n}});return c.formatWithOptions(r,...e)}};function s(o={}){const t=new WeakSet;return function(r,e){if(typeof e=="object"&&e!==null){if(t.has(e))return;t.add(e)}return i(r,e,o)}}function i(o,t,r={}){const e=(r==null?void 0:r.serializeMapAndSet)!==!1;return t instanceof Error?t.stack:t&&(typeof t=="function"?`[function] ${t.toString()}`:t instanceof Date?t.toISOString():e&&t instanceof Map&&Object.fromEntries?Object.fromEntries(t):e&&t instanceof Set&&Array.from?Array.from(t):t)}}(K)),K.exports}var X,Ae;function pe(){if(Ae)return X;Ae=1,X={transformStyles:i,applyAnsiStyles({data:o}){return i(o,c,s)},removeStyles({data:o}){return i(o,()=>"")}};const h={unset:"\x1B[0m",black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"};function c(o){const t=o.replace(/color:\s*(\w+).*/,"$1").toLowerCase();return h[t]||""}function s(o){return o+h.unset}function i(o,t,r){const e={};return o.reduce((n,a,u,d)=>{if(e[u])return n;if(typeof a=="string"){let g=u,w=!1;a=a.replace(/%[1cdfiOos]/g,A=>{if(g+=1,A!=="%c")return A;const P=d[g];return typeof P=="string"?(e[g]=!0,w=!0,t(P,a)):A}),w&&r&&(a=r(a))}return n.push(a),n},[])}return X}var Z,Oe;function ft(){if(Oe)return Z;Oe=1;const{concatFirstStringElements:h,format:c}=Be(),{maxDepth:s,toJSON:i}=_(),{applyAnsiStyles:o,removeStyles:t}=pe(),{transform:r}=D(),e={error:console.error,warn:console.warn,info:console.info,verbose:console.info,debug:console.debug,silly:console.debug,log:console.log};Z=u;const a=`%c{h}:{i}:{s}.{ms}{scope}%c ${process.platform==="win32"?">":"›"} {text}`;Object.assign(u,{DEFAULT_FORMAT:a});function u(P){return Object.assign(b,{format:a,level:"silly",transforms:[d,c,w,h,s,i],useStyles:process.env.FORCE_STYLES,writeFn({message:x}){(e[x.level]||e.info)(...x.data)}});function b(x){const j=r({logger:P,message:x,transport:b});b.writeFn({message:{...x,data:j}})}}function d({data:P,message:b,transport:x}){return typeof x.format!="string"||!x.format.includes("%c")?P:[`color:${A(b.level)}`,"color:unset",...P]}function g(P,b){if(typeof P=="boolean")return P;const j=b==="error"||b==="warn"?process.stderr:process.stdout;return j&&j.isTTY}function w(P){const{message:b,transport:x}=P;return(g(x.useStyles,b.level)?o:t)(P)}function A(P){const b={error:"red",warn:"yellow",info:"cyan",default:"unset"};return b[P]||b.default}return Z}var ee,De;function Je(){if(De)return ee;De=1;const h=Me,c=m,s=R;class i extends h{constructor({path:e,writeOptions:n={encoding:"utf8",flag:"a",mode:438},writeAsync:a=!1}){super();y(this,"asyncWriteQueue",[]);y(this,"bytesWritten",0);y(this,"hasActiveAsyncWriting",!1);y(this,"path",null);y(this,"initialSize");y(this,"writeOptions",null);y(this,"writeAsync",!1);this.path=e,this.writeOptions=n,this.writeAsync=a}get size(){return this.getSize()}clear(){try{return c.writeFileSync(this.path,"",{mode:this.writeOptions.mode,flag:"w"}),this.reset(),!0}catch(e){return e.code==="ENOENT"?!0:(this.emit("error",e,this),!1)}}crop(e){try{const n=o(this.path,e||4096);this.clear(),this.writeLine(`[log cropped]${s.EOL}${n}`)}catch(n){this.emit("error",new Error(`Couldn't crop file ${this.path}. ${n.message}`),this)}}getSize(){if(this.initialSize===void 0)try{const e=c.statSync(this.path);this.initialSize=e.size}catch{this.initialSize=0}return this.initialSize+this.bytesWritten}increaseBytesWrittenCounter(e){this.bytesWritten+=Buffer.byteLength(e,this.writeOptions.encoding)}isNull(){return!1}nextAsyncWrite(){const e=this;if(this.hasActiveAsyncWriting||this.asyncWriteQueue.length===0)return;const n=this.asyncWriteQueue.join("");this.asyncWriteQueue=[],this.hasActiveAsyncWriting=!0,c.writeFile(this.path,n,this.writeOptions,a=>{e.hasActiveAsyncWriting=!1,a?e.emit("error",new Error(`Couldn't write to ${e.path}. ${a.message}`),this):e.increaseBytesWrittenCounter(n),e.nextAsyncWrite()})}reset(){this.initialSize=void 0,this.bytesWritten=0}toString(){return this.path}writeLine(e){if(e+=s.EOL,this.writeAsync){this.asyncWriteQueue.push(e),this.nextAsyncWrite();return}try{c.writeFileSync(this.path,e,this.writeOptions),this.increaseBytesWrittenCounter(e)}catch(n){this.emit("error",new Error(`Couldn't write to ${this.path}. ${n.message}`),this)}}}ee=i;function o(t,r){const e=Buffer.alloc(r),n=c.statSync(t),a=Math.min(n.size,r),u=Math.max(0,n.size-r),d=c.openSync(t,"r"),g=c.readSync(d,e,0,a,u);return c.closeSync(d),e.toString("utf8",0,g)}return ee}var te,Le;function gt(){if(Le)return te;Le=1;const h=Je();class c extends h{clear(){}crop(){}getSize(){return 0}isNull(){return!0}writeLine(){}}return te=c,te}var re,Fe;function mt(){if(Fe)return re;Fe=1;const h=Me,c=m,s=l,i=Je(),o=gt();class t extends h{constructor(){super();y(this,"store",{});this.emitError=this.emitError.bind(this)}provide({filePath:n,writeOptions:a={},writeAsync:u=!1}){let d;try{if(n=s.resolve(n),this.store[n])return this.store[n];d=this.createFile({filePath:n,writeOptions:a,writeAsync:u})}catch(g){d=new o({path:n}),this.emitError(g,d)}return d.on("error",this.emitError),this.store[n]=d,d}createFile({filePath:n,writeOptions:a,writeAsync:u}){return this.testFileWriting({filePath:n,writeOptions:a}),new i({path:n,writeOptions:a,writeAsync:u})}emitError(n,a){this.emit("error",n,a)}testFileWriting({filePath:n,writeOptions:a}){c.mkdirSync(s.dirname(n),{recursive:!0}),c.writeFileSync(n,"",{flag:"a",mode:a.mode})}}return re=t,re}var se,Re;function yt(){if(Re)return se;Re=1;const h=m,c=R,s=l,i=mt(),{transform:o}=D(),{removeStyles:t}=pe(),{format:r,concatFirstStringElements:e}=Be(),{toString:n}=_();se=u;const a=new i;function u(g,{registry:w=a,externalApi:A}={}){let P;return w.listenerCount("error")<1&&w.on("error",($,v)=>{j(`Can't write to ${v}`,$)}),Object.assign(b,{fileName:d(g.variables.processType),format:"[{y}-{m}-{d} {h}:{i}:{s}.{ms}] [{level}]{scope} {text}",getFile:k,inspectOptions:{depth:5},level:"silly",maxSize:1024**2,readAllLogs:Ge,sync:!0,transforms:[t,r,e,n],writeOptions:{flag:"a",mode:438,encoding:"utf8"},archiveLogFn($){const v=$.toString(),E=s.parse(v);try{h.renameSync(v,s.join(E.dir,`${E.name}.old${E.ext}`))}catch(L){j("Could not rotate log",L);const Ye=Math.round(b.maxSize/4);$.crop(Math.min(Ye,256*1024))}},resolvePathFn($){return s.join($.libraryDefaultDir,$.fileName)},setAppName($){g.dependencies.externalApi.setAppName($)}});function b($){const v=k($);b.maxSize>0&&v.size>b.maxSize&&(b.archiveLogFn(v),v.reset());const L=o({logger:g,message:$,transport:b});v.writeLine(L)}function x(){P||(P=Object.create(Object.prototype,{...Object.getOwnPropertyDescriptors(A.getPathVariables()),fileName:{get(){return b.fileName},enumerable:!0}}),typeof b.archiveLog=="function"&&(b.archiveLogFn=b.archiveLog,j("archiveLog is deprecated. Use archiveLogFn instead")),typeof b.resolvePath=="function"&&(b.resolvePathFn=b.resolvePath,j("resolvePath is deprecated. Use resolvePathFn instead")))}function j($,v=null,E="error"){const L=[`electron-log.transports.file: ${$}`];v&&L.push(v),g.transports.console({data:L,date:new Date,level:E})}function k($){x();const v=b.resolvePathFn(P,$);return w.provide({filePath:v,writeAsync:!b.sync,writeOptions:b.writeOptions})}function Ge({fileFilter:$=v=>v.endsWith(".log")}={}){x();const v=s.dirname(b.resolvePathFn(P));return h.existsSync(v)?h.readdirSync(v).map(E=>s.join(v,E)).filter($).map(E=>{try{return{path:E,lines:h.readFileSync(E,"utf8").split(c.EOL)}}catch{return null}}).filter(Boolean):[]}}function d(g=process.type){switch(g){case"renderer":return"renderer.log";case"worker":return"worker.log";default:return"main.log"}}return se}var ne,_e;function wt(){if(_e)return ne;_e=1;const{maxDepth:h,toJSON:c}=_(),{transform:s}=D();ne=i;function i(o,{externalApi:t}){return Object.assign(r,{depth:3,eventId:"__ELECTRON_LOG_IPC__",level:o.isDev?"silly":!1,transforms:[c,h]}),t!=null&&t.isElectron()?r:void 0;function r(e){var n;((n=e==null?void 0:e.variables)==null?void 0:n.processType)!=="renderer"&&(t==null||t.sendIpc(r.eventId,{...e,data:s({logger:o,message:e,transport:r})}))}}return ne}var oe,ke;function bt(){if(ke)return oe;ke=1;const h=et,c=tt,{transform:s}=D(),{removeStyles:i}=pe(),{toJSON:o,maxDepth:t}=_();oe=r;function r(e){return Object.assign(n,{client:{name:"electron-application"},depth:6,level:!1,requestOptions:{},transforms:[i,o,t],makeBodyFn({message:a}){return JSON.stringify({client:n.client,data:a.data,date:a.date.getTime(),level:a.level,scope:a.scope,variables:a.variables})},processErrorFn({error:a}){e.processMessage({data:[`electron-log: can't POST ${n.url}`,a],level:"warn"},{transports:["console","file"]})},sendRequestFn({serverUrl:a,requestOptions:u,body:d}){const w=(a.startsWith("https:")?c:h).request(a,{method:"POST",...u,headers:{"Content-Type":"application/json","Content-Length":d.length,...u.headers}});return w.write(d),w.end(),w}});function n(a){if(!n.url)return;const u=n.makeBodyFn({logger:e,message:{...a,data:s({logger:e,message:a,transport:n})},transport:n}),d=n.sendRequestFn({serverUrl:n.url,requestOptions:n.requestOptions,body:Buffer.from(u,"utf8")});d.on("error",g=>n.processErrorFn({error:g,logger:e,message:a,request:d,transport:n}))}}return oe}var ie,We;function He(){if(We)return ie;We=1;const h=Ie(),c=ht(),s=dt(),i=ft(),o=yt(),t=wt(),r=bt();ie=e;function e({dependencies:n,initializeFn:a}){var d;const u=new h({dependencies:n,errorHandler:new c,eventLogger:new s,initializeFn:a,isDev:(d=n.externalApi)==null?void 0:d.isDev(),logId:"default",transportFactories:{console:i,file:o,ipc:t,remote:r},variables:{processType:"main"}});return u.default=u,u.Logger=h,u.processInternalErrorFn=g=>{u.transports.console.writeFn({message:{data:["Unhandled electron-log error",g],level:"error"}})},u}return ie}var ae,Ce;function Pt(){if(Ce)return ae;Ce=1;const h=f,c=lt(),{initialize:s}=ut(),i=He(),o=new c({electron:h}),t=i({dependencies:{externalApi:o},initializeFn:s});ae=t,o.onIpc("__ELECTRON_LOG__",(e,n)=>{n.scope&&t.Logger.getInstance(n).scope(n.scope);const a=new Date(n.date);r({...n,date:a.getTime()?a:new Date})}),o.onIpcInvoke("__ELECTRON_LOG__",(e,{cmd:n="",logId:a})=>{switch(n){case"getOptions":return{levels:t.Logger.getInstance({logId:a}).levels,logId:a};default:return r({data:[`Unknown cmd '${n}'`],level:"error"}),{}}});function r(e){var n;(n=t.Logger.getInstance(e))==null||n.processMessage(e)}return ae}var ce,ze;function vt(){if(ze)return ce;ze=1;const h=Ue(),c=He(),s=new h;return ce=c({dependencies:{externalApi:s}}),ce}var qe;function St(){if(qe)return F.exports;qe=1;const h=typeof process>"u"||process.type==="renderer"||process.type==="worker",c=typeof process=="object"&&process.type==="browser";return h?(Te(),F.exports=ct()):c?F.exports=Pt():F.exports=vt(),F.exports}var $t=St();const p=rt($t);function xt(){const h=f.app.getAppPath(),c=process.resourcesPath,s=[{name:"Contents/Resources/assets",path:l.join(c,"assets")},{name:"Contents/Resources/app.asar/assets",path:l.join(c,"app.asar","assets")},{name:"親ディレクトリ/assets",path:l.join(h,"..","assets")},{name:"親ディレクトリ/Resources/assets",path:l.join(h,"..","Resources","assets")},{name:"Contents/MacOS/../Resources/assets",path:l.join(f.app.getPath("exe"),"..","..","Resources","assets")}];return p.info("=========== macOS固有パス検証 開始 ==========="),s.forEach(({name:i,path:o})=>{const t=m.existsSync(o);if(p.info(`macOS検証 - ${i}:`,o,`(存在: ${t?"✓":"✗"})`),t)try{const r=m.readdirSync(o);p.info(`macOS検証 - ${i} 内のアイテム数:`,r.length),p.info(`macOS検証 - ${i} 内のアイテム:`,r);const e=m.statSync(o);p.info(`macOS検証 - ${i} の権限モード:`,e.mode.toString(8)),p.info(`macOS検証 - ${i} 読み取り可能:`,!!(e.mode&m.constants.R_OK))}catch(r){p.error(`macOS検証 - ${i} 読み取りエラー:`,r)}}),p.info("=========== macOS固有パス検証 終了 ==========="),s.filter(({path:i})=>m.existsSync(i)).map(({path:i})=>i)}function Ve(){const h=process.resourcesPath,c=f.app.getAppPath(),s=f.app.getAppPath(),i=f.app.getPath("exe");p.info("=============== アセットパス検証 開始 ==============="),p.info("パス検証 - プロセス - リソースパス:",h),p.info("パス検証 - アプリケーションパス:",c),p.info("パス検証 - アプリケーションディレクトリ:",s),p.info("パス検証 - 実行ファイルパス:",i),p.info("パス検証 - Electronアプリのパッケージ状態:",f.app.isPackaged?"パッケージ済み":"開発モード"),p.info("パス検証 - asarパッケージ:",f.app.isPackaged?"true（asarチェックを含む）":"false（開発モード）");const o=[{name:"リソースパス/app.asar.unpacked/アセット",path:l.join(h,"app.asar.unpacked","assets")},{name:"リソースパス/アセット",path:l.join(h,"assets")},{name:"リソースパス/app.asar/アセット",path:l.join(h,"app.asar","assets")},{name:"リソースパス/app/アセット",path:l.join(h,"app","assets")},{name:"アプリパス/アセット",path:l.join(c,"assets")},{name:"アプリパス/リソース/アセット",path:l.join(c,"resources","assets")},{name:"アプリパス/src/アセット",path:l.join(c,"src","assets")},{name:"exeの親ディレクトリ/アセット",path:l.join(i,"..","assets")},{name:"exeの親の親ディレクトリ/アセット",path:l.join(i,"../..","assets")},{name:"exeの親の親/リソース/アセット",path:l.join(i,"../../Resources","assets")},{name:"appPathの親/アセット",path:l.join(c,"..","assets")},{name:"appPathの親/Resources/アセット",path:l.join(c,"..","Resources","assets")}];return o.forEach(({name:t,path:r})=>{const e=m.existsSync(r);if(p.info(`パス検証 - ${t}:`,r,`(存在: ${e?"✓":"✗"})`),e)try{const n=m.statSync(r);if(p.info(`パス検証 - ${t} はディレクトリ:`,n.isDirectory()),n.isDirectory()){const a=m.readdirSync(r);p.info(`パス検証 - ${t} 内のアイテム数:`,a.length),a.length>0&&(p.info(`パス検証 - ${t} 内のサンプルアイテム:`,a.slice(0,5)),["images","cards","ui","localization"].forEach(u=>{const d=l.join(r,u),g=m.existsSync(d);if(p.info(`パス検証 - ${t}/${u}:`,`(存在: ${g?"✓":"✗"})`),g)try{const w=m.readdirSync(d);p.info(`パス検証 - ${t}/${u} 内のアイテム数:`,w.length),w.length>0&&p.info(`パス検証 - ${t}/${u} 内のサンプルアイテム:`,w.slice(0,3))}catch(w){p.error(`パス検証 - ${t}/${u} の読み込みエラー:`,w)}}))}}catch(n){p.error(`パス検証 - ${t} の読み込みエラー:`,n)}}),process.platform==="darwin"&&f.app.isPackaged&&xt(),p.info("=============== アセットパス検証 終了 ==============="),o.filter(({path:t})=>m.existsSync(t)).map(({path:t})=>t)}p.transports.file.level="debug";p.transports.console.level="debug";p.info("Application starting...");p.info("Process type:",process.type);p.info("Electron version:",process.versions.electron);p.info("Node version:",process.versions.node);p.info("Chrome version:",process.versions.chrome);const Ne=require("electron-store");let O;try{p.info("Initializing Store..."),p.info("User data path:",f.app.getPath("userData")),p.info("Store constructor type:",typeof Ne),O=new Ne({name:"config",cwd:f.app.getPath("userData"),defaults:{windowBounds:{width:1280,height:720},settings:{theme:"light",language:"ja"}}}),p.info("Store initialized successfully")}catch(h){p.error("Failed to initialize store:",h),f.app.exit(1)}let S=null;function jt(){f.ipcMain.handle("get-theme",()=>{try{return O.get("settings").theme}catch(h){return p.error("Error getting theme:",h),"light"}}),f.ipcMain.handle("set-theme",(h,c)=>{try{const s=O.get("settings");return s.theme=c,O.set("settings",s),c}catch(s){throw p.error("Error setting theme:",s),s}}),f.ipcMain.handle("get-resource-path",()=>f.app.isPackaged?l.join(process.resourcesPath,"assets"):l.join(f.app.getAppPath(),"src","assets")),f.ipcMain.handle("asset-exists",(h,c)=>{try{let s=c;s.startsWith("assets/")&&(s=s.substring(7),p.debug(`[asset-exists] パスから'assets/'プレフィックスを削除: ${c} -> ${s}`));let i;if(f.app.isPackaged)if(process.platform==="win32"){const t=[l.join(process.resourcesPath,"assets",s),l.join(process.resourcesPath,"app.asar.unpacked","assets",s),l.join(f.app.getPath("exe"),"..","resources","assets",s),l.join(f.app.getPath("exe"),"..","assets",s)];for(const r of t){const e=l.normalize(r);p.debug(`[asset-exists] Windowsパス検証: ${r} -> ${e}`);let n=!1;try{if(n=m.existsSync(e),!n&&process.platform==="win32"){const a=e.toLowerCase(),u=e.toUpperCase();n=m.existsSync(a)||m.existsSync(u),n&&p.debug(`[asset-exists] Found with case-insensitive check: ${e}`)}}catch(a){p.warn(`[asset-exists] Error checking path existence: ${e}`,a)}if(n){i=e,p.debug(`[asset-exists] Windowsで有効なパスを発見: ${e}`);break}}}else{const t=[l.join(process.resourcesPath,"app.asar.unpacked","assets",s),l.join(process.resourcesPath,"assets",s),l.join(process.resourcesPath,"app.asar","assets",s)];for(const r of t)if(m.existsSync(r)){i=r;break}}else{const t=[l.join(f.app.getAppPath(),"public","assets",s),l.join(f.app.getAppPath(),"resources","assets",s),l.join(f.app.getAppPath(),"dist","assets",s),l.join(f.app.getAppPath(),"src","assets",s)];for(const r of t){const e=l.normalize(r);if(m.existsSync(e)){i=e;break}}}const o=i?m.existsSync(i):!1;return p.debug(`[asset-exists] ファイルの存在確認: ${c} (解決後: ${i||"未解決"}) - ${o?"存在します":"存在しません"}`),o}catch(s){return p.error(`[asset-exists] エラー: ${c}`,s),!1}}),f.ipcMain.handle("get-asset-path",(h,c)=>{try{S&&!S.isDestroyed()&&S.webContents.send("main-process-log",{level:"info",message:`[get-asset-path] リクエスト: ${c}`});let s=c;s.startsWith("assets/")&&(s=s.substring(7),p.debug(`[get-asset-path] パスから'assets/'プレフィックスを削除: ${c} -> ${s}`));let i;if(f.app.isPackaged){if(process.platform==="darwin"){const t=[l.join(process.resourcesPath,"app.asar.unpacked","assets",s),l.join(process.resourcesPath,"assets",s),l.join(f.app.getAppPath(),"..","..","Resources","assets",s),l.join(f.app.getAppPath(),"..","Resources","assets",s),l.join(f.app.getAppPath(),"..","..","assets",s),l.join(process.resourcesPath,"app.asar","assets",s),l.join(process.resourcesPath,"app","assets",s)];for(const e of t)if(p.debug(`[get-asset-path] macOSパス検証: ${e}`),m.existsSync(e)){i=e,p.debug(`[get-asset-path] macOSで有効なパスを発見: ${e}`);break}if(i)return p.debug(`[get-asset-path] macOS用パス解決: ${c} -> ${i}`),i;p.warn(`[get-asset-path] macOSでパスが見つかりませんでした: ${c}`),p.info("[get-asset-path] ASAR環境外のパスを試します");const r=[l.join(f.app.getAppPath(),"..","..","..","assets",s),l.join(f.app.getAppPath(),"..","..","..","..","assets",s),l.join(process.resourcesPath,"..","assets",s)];for(const e of r)if(p.debug(`[get-asset-path] macOS ASAR外パス検証: ${e}`),m.existsSync(e)){i=e,p.debug(`[get-asset-path] macOS ASAR外で有効なパスを発見: ${e}`);break}if(i)return p.debug(`[get-asset-path] macOS ASAR外パス解決: ${c} -> ${i}`),i}else if(process.platform==="win32"){const t=[];t.push(l.join(process.resourcesPath,"assets",s)),t.push(l.join(process.resourcesPath,"app.asar.unpacked","assets",s));const r=f.app.getPath("exe"),e=l.normalize(r);p.debug(`[get-asset-path] Windows Exe directory: ${r} -> ${e}`);const n=l.normalize(l.join(r,".."));t.push(l.join(n,"resources","assets",s)),t.push(l.join(n,"assets",s)),t.push(l.join(n,"resources",s)),t.push(l.join(f.app.getAppPath(),"resources","assets",s)),t.push(l.join(f.app.getAppPath(),"..","resources","assets",s)),t.push(l.join(f.app.getAppPath(),"..","assets",s)),t.push(l.join(f.app.getAppPath(),"assets",s)),t.push(l.join(process.resourcesPath,"app.asar","assets",s));for(const a of t){const u=l.normalize(a);p.debug(`[get-asset-path] Windowsパス検証: ${a} -> ${u}`);let d=!1;try{if(d=m.existsSync(u),!d&&process.platform==="win32"){const g=u.toLowerCase(),w=u.toUpperCase();d=m.existsSync(g)||m.existsSync(w),d&&p.debug(`[get-asset-path] Found with case-insensitive check: ${u}`)}}catch(g){p.warn(`[get-asset-path] Error checking path existence: ${u}`,g)}if(d){i=u,p.info(`[get-asset-path] Windowsで有効なパスを発見: ${u}`);break}else p.warn(`[get-asset-path] Windowsパスが見つかりません: ${u}`)}if(i)return p.info(`[get-asset-path] Windows用パス解決: ${c} -> ${i}`),S&&!S.isDestroyed()&&S.webContents.send("main-process-log",{level:"info",message:`[get-asset-path] Windows用パス解決成功: ${c} -> ${i}`}),i;p.warn(`[get-asset-path] Windowsでパスが見つかりませんでした: ${c} (正規化後: ${s})`),p.warn("[get-asset-path] 試行したパス:",t.map(a=>l.normalize(a))),S&&!S.isDestroyed()&&S.webContents.send("main-process-log",{level:"error",message:`[get-asset-path] Windowsでパスが見つかりませんでした: ${c}`,details:t.map(a=>l.normalize(a))})}const o=[l.join(process.resourcesPath,"app.asar.unpacked","assets",s),l.join(process.resourcesPath,"assets",s),l.join(process.resourcesPath,"app.asar","assets",s),l.join(f.app.getAppPath(),"resources","assets",s),l.join(f.app.getAppPath(),"..","assets",s),l.join(f.app.getAppPath(),"assets",s)];for(const t of o){const r=l.normalize(t);if(m.existsSync(r)){i=r;break}}i||(i=l.normalize(o[0]),p.warn(`[get-asset-path] 警告: アセットが見つかりません: ${s}, 使用パス: ${i}`))}else{const o=[l.join(f.app.getAppPath(),"public","assets",s),l.join(f.app.getAppPath(),"resources","assets",s),l.join(f.app.getAppPath(),"dist","assets",s),l.join(f.app.getAppPath(),"src","assets",s)];for(const t of o){const r=l.normalize(t);if(m.existsSync(r)){i=r;break}}i||(i=l.normalize(o[0]))}return p.debug(`[get-asset-path] リクエスト: ${c} (正規化: ${s}) -> 解決: ${i}`),S&&!S.isDestroyed()&&S.webContents.send("main-process-log",{level:"info",message:`[get-asset-path] パス解決完了: ${c} -> ${i}`}),i}catch(s){throw p.error(`[get-asset-path] エラー: ${c}`,s),S&&!S.isDestroyed()&&S.webContents.send("main-process-log",{level:"error",message:`[get-asset-path] エラー: ${c}`,error:s instanceof Error?s.message:String(s)}),s}}),f.ipcMain.handle("get-image-base64",async(h,c)=>{var s;try{let i;if(f.app.isPackaged){const e=[];if(c.startsWith("assets/")?(e.push(l.join(process.resourcesPath,c)),e.push(l.join(process.resourcesPath,"app.asar.unpacked",c))):(e.push(l.join(process.resourcesPath,"assets",c)),e.push(l.join(process.resourcesPath,"app.asar.unpacked","assets",c))),process.platform==="win32"){const n=f.app.getPath("exe");c.startsWith("assets/")?(e.push(l.join(n,"..","resources",c)),e.push(l.join(n,"..","resources",c.substring(7)))):(e.push(l.join(n,"..","resources","assets",c)),e.push(l.join(n,"..","resources",c)))}for(const n of e){const a=l.normalize(n);if(p.debug(`[get-image-base64] Checking path: ${n} -> ${a}`),m.existsSync(a)){i=a,p.debug(`[get-image-base64] Found image at: ${i}`);break}}i||(p.warn(`[get-image-base64] Image not found in any of the tried paths for: ${c}`),i=l.normalize(e[0]))}else{const e=[l.join(f.app.getAppPath(),"public","assets",c),l.join(f.app.getAppPath(),"public","assets","assets",c),l.join(f.app.getAppPath(),"src","assets",c)];for(const n of e){const a=l.normalize(n);if(m.existsSync(a)){i=a;break}}i||(p.warn(`[get-image-base64-dev] Image not found in public/assets or src/assets. Path tried: ${e.join(", ")}`),i=l.normalize(e[0]))}if(p.debug(`[get-image-base64] Attempting to read image from: ${i} (requested: ${c})`),!i||!m.existsSync(i))return p.error(`[get-image-base64] Final check: Image file does not exist at resolved path: ${i}`),f.app.isPackaged,null;const o=await m.promises.readFile(i),t=((s=c.split(".").pop())==null?void 0:s.toLowerCase())||"png";let r="image/png";switch(t){case"jpg":case"jpeg":r="image/jpeg";break;case"gif":r="image/gif";break;case"svg":r="image/svg+xml";break;case"webp":r="image/webp";break}return p.debug(`[get-image-base64] Successfully read image, generating base64 for MIME type: ${r}`),`data:${r};base64,${o.toString("base64")}`}catch(i){return p.error(`[get-image-base64] Failed to load image ${c}:`,i),null}}),f.ipcMain.handle("get-file-url-for-asset",async(h,c)=>{p.info(`[IPC:get-file-url-for-asset] Received original assetPath from renderer: "${c}"`);let s=c;s.startsWith("assets/")?p.info(`[IPC:get-file-url-for-asset] Path already started with 'assets/'. Using as is: "${s}"`):s.startsWith("ui/")||s.startsWith("images/")||s.startsWith("fonts/")||s.startsWith("relics/")||s.startsWith("localization/")?(p.info(`[IPC:get-file-url-for-asset] Path did not start with 'assets/'. Prepending 'assets/' to: "${s}"`),s=`assets/${s}`):p.info(`[IPC:get-file-url-for-asset] Path did not start with 'assets/' and is not a known assets subdirectory. Using as is: "${s}"`);const i=`asset://${s}`;return p.info(`[IPC:get-file-url-for-asset] Returning asset URL for protocol: "${i}"`),i}),f.ipcMain.handle("debug-resources",()=>{try{return{isPackaged:f.app.isPackaged,resourcesPath:process.resourcesPath,appPath:f.app.getAppPath(),execPath:f.app.getPath("exe"),userDataPath:f.app.getPath("userData"),appDataPath:f.app.getPath("appData"),platform:process.platform,arch:process.arch,validatedPaths:Ve()}}catch(h){throw p.error("[debug-resources] エラー",h),h}}),f.ipcMain.handle("is-app-packaged",()=>f.app.isPackaged),f.ipcMain.handle("fs-readFile",async(h,c,s="utf8")=>{try{return await m.promises.readFile(c,s)}catch(i){throw p.error(`[fs-readFile] Error reading file ${c}:`,i),i}}),f.ipcMain.handle("app-getPath",(h,c)=>{try{return f.app.getPath(c)}catch(s){throw p.error(`[app-getPath] Error getting path for ${c}:`,s),s}}),f.ipcMain.handle("dialog-showOpenDialog",async(h,c)=>{const s=f.BrowserWindow.getFocusedWindow();if(!s)throw p.error("[dialog-showOpenDialog] No focused window available."),new Error("No focused window available for dialog.");try{return await f.dialog.showOpenDialog(s,c)}catch(i){throw p.error("[dialog-showOpenDialog] Error showing open dialog with options:",c,i),i}}),f.ipcMain.handle("select-folder",async()=>{const h=f.BrowserWindow.getFocusedWindow();if(!h)throw p.error("[select-folder] No focused window available."),new Error("No focused window available for dialog.");try{const c=await f.dialog.showOpenDialog(h,{properties:["openDirectory"],title:"Slay the Spireのrunsフォルダを選択"});if(c.canceled||!c.filePaths||c.filePaths.length===0)return p.info("[select-folder] フォルダ選択がキャンセルされました"),null;const s=c.filePaths[0];return p.info(`[select-folder] 選択されたフォルダ: ${s}`),s}catch(c){throw p.error("[select-folder] フォルダ選択エラー:",c),c}}),f.ipcMain.handle("load-run-files",async(h,c)=>{var s,i;try{if(p.info(`[load-run-files] フォルダパス: ${c}`),!m.existsSync(c))throw new Error(`フォルダが見つかりません: ${c}`);const o=[],t=n=>{const a=m.readdirSync(n,{withFileTypes:!0});for(const u of a){const d=l.join(n,u.name);u.isDirectory()?t(d):u.isFile()&&u.name.endsWith(".run")&&o.push(d)}};if(t(c),p.info(`[load-run-files] 見つかった.runファイル数: ${o.length}`),o.length===0)return p.warn("[load-run-files] .runファイルが見つかりませんでした"),[];const r=(n,a)=>{S&&!S.isDestroyed()&&S.webContents.send("load-progress",{progress:n,total:a})},e=[];for(let n=0;n<o.length;n++){const a=o[n];try{const u=await m.promises.readFile(a,"utf8"),d=JSON.parse(u),g={id:d.play_id||a,timestamp:d.timestamp||0,character:d.character_chosen||d.character||"UNKNOWN",character_chosen:d.character_chosen||d.character||"UNKNOWN",ascension_level:d.ascension_level||0,victory:d.victory||!1,floor_reached:d.floor_reached||0,playtime:d.playtime||0,score:d.score||0,run_data:d,neow_bonus:d.neow_bonus||((s=d.run_data)==null?void 0:s.neow_bonus)||void 0,neow_cost:d.neow_cost||((i=d.run_data)==null?void 0:i.neow_cost)||void 0};e.push(g),r(n+1,o.length)}catch(u){p.error(`[load-run-files] ファイルの読み込みエラー: ${a}`,u)}}return p.info(`[load-run-files] 読み込み完了: ${e.length}件のランを読み込みました`),e}catch(o){throw p.error("[load-run-files] エラー:",o),o}}),f.ipcMain.handle("get-all-runs",async()=>(p.info("[IPC DUMMY] get-all-runs called"),[])),f.ipcMain.handle("get-run-folder",async()=>(p.info("[IPC DUMMY] get-run-folder called"),null)),f.ipcMain.handle("check-for-updates",async()=>(p.info("[IPC DUMMY] check-for-updates called"),null))}async function Et(){try{p.info("Creating main window..."),p.info("アセットパスの検証を開始...");const h=Ve();if(p.info("有効なアセットパス:",h),!O){p.error("Store is not initialized"),f.app.exit(1);return}const c=O.get("windowBounds");p.info("Window bounds from store:",c);const s=new f.BrowserWindow({width:c.width,height:c.height,webPreferences:{preload:l.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0,webSecurity:!1,sandbox:!1}});S=s,(process.env.NODE_ENV==="development"||!f.app.isPackaged)&&s.webContents.openDevTools();try{if(p.info("Initializing application components..."),jt(),process.env.NODE_ENV==="development"||!f.app.isPackaged)p.info("Loading development URL..."),await s.loadURL("http://localhost:5173");else{p.info("Loading production file..."),p.info("__dirname:",__dirname),p.info("app.getAppPath():",f.app.getAppPath()),p.info("process.resourcesPath:",process.resourcesPath),p.info("app.isPackaged:",f.app.isPackaged);const i=[];process.platform==="win32"?i.push(l.join(process.resourcesPath,"dist","index.html"),l.join(f.app.getPath("exe"),"..","resources","dist","index.html"),l.join(process.resourcesPath,"app.asar.unpacked","dist","index.html"),l.join(f.app.getPath("exe"),"..","resources","app.asar.unpacked","dist","index.html"),l.join(process.resourcesPath,"app.asar","dist","index.html"),l.join(f.app.getPath("exe"),"..","resources","app.asar","dist","index.html"),l.join(__dirname,"../dist/index.html"),l.join(__dirname,"../../dist/index.html"),l.join(__dirname,"dist/index.html"),l.join(f.app.getAppPath(),"dist/index.html"),l.join(f.app.getAppPath(),"../dist/index.html")):i.push(l.join(__dirname,"../dist/index.html"),l.join(__dirname,"../../dist/index.html"),l.join(f.app.getAppPath(),"dist/index.html"),l.join(process.resourcesPath,"app.asar/dist/index.html"),l.join(process.resourcesPath,"app.asar.unpacked/dist/index.html"));let o;for(const e of i){const n=l.normalize(e);if(p.info(`[createWindow] Checking index.html path: ${e} -> ${n}`),m.existsSync(n)){o=n,p.info(`[createWindow] Found index.html at: ${o}`);break}}if(!o)throw p.error("[createWindow] index.html not found in any of the tried paths"),p.error("[createWindow] Tried paths:",i.map(e=>l.normalize(e))),new Error(`index.html not found. Tried paths: ${i.join(", ")}`);p.info("[createWindow] Loading index.html from:",o);const t=l.normalize(l.join(o,".."));p.info("[createWindow] dist directory:",t);const r=l.join(t,"assets");if(p.info("[createWindow] dist/assets directory:",r),m.existsSync(r)){const e=m.readdirSync(r);p.info("[createWindow] Files in dist/assets:",e.slice(0,10))}else p.warn("[createWindow] dist/assets directory not found:",r);s.webContents.on("did-fail-load",(e,n,a,u,d)=>{if(d)p.error(`[createWindow] Failed to load main frame: ${n} - ${a} - ${u}`);else if(p.warn(`[createWindow] Failed to load resource: ${n} - ${a} - ${u}`),u){const g=u.replace(/^file:\/\/\//,"").replace(/\//g,process.platform==="win32"?"\\":"/");p.warn(`[createWindow] Attempted resource path: ${g}`),p.warn(`[createWindow] Expected dist directory: ${t}`);const w=l.join(t,g.replace(t,"").replace(/^[\/\\]/,""));p.warn(`[createWindow] Expected resource path: ${w}`),p.warn(`[createWindow] Resource exists: ${m.existsSync(w)}`)}}),s.webContents.on("did-finish-load",()=>{p.info("[createWindow] Page finished loading")}),await s.loadFile(o)}return s.on("resize",()=>{try{const{width:i,height:o}=s.getBounds();O.set("windowBounds",{width:i,height:o}),p.info("Window bounds saved:",{width:i,height:o})}catch(i){p.error("Error saving window bounds:",i)}}),p.info("Application initialized successfully"),s}catch(i){throw p.error("Error during application initialization:",i),i}}catch(h){throw p.error("Error creating window:",h),h}}f.app.on("ready",async()=>{try{p.info("App ready event fired"),f.protocol.isProtocolHandled("asset")||(p.info("Registering 'asset' protocol handler"),f.protocol.registerFileProtocol("asset",(c,s)=>{try{p.info("[asset-protocol] --------------- Request Start ---------------"),p.info(`[asset-protocol] Intercepted request.url: "${c.url}"`),h&&!h.isDestroyed()&&h.webContents.send("main-process-log",{level:"info",message:`[asset-protocol] リクエスト: ${c.url}`});const i=decodeURIComponent(c.url);p.info(`[asset-protocol] Decoded request.url: "${i}"`);let o=i.replace("asset://","");if(p.info(`[asset-protocol] Initial requestedAssetPath (after 'asset://' removal): "${o}"`),o.startsWith("./")){const e=o;o=o.substring(2),p.warn(`[asset-protocol] Normalized leading './': "${e}" -> "${o}"`)}if(o.startsWith("assets/assets/")){const e=o;o=o.substring(7),p.warn(`[asset-protocol] Normalized double 'assets/' prefix: "${e}" -> "${o}"`)}p.info(`[asset-protocol] Requested asset (normalized): "${o}"`);const t=[];if(!f.app.isPackaged)t.push({path:l.join(f.app.getAppPath(),"public",o),description:`Dev (public/${o})`}),t.push({path:l.join(f.app.getAppPath(),"src",o),description:`Dev (src/${o})`}),o.startsWith("assets/")||(t.push({path:l.join(f.app.getAppPath(),"public","assets",o),description:`Dev (public/assets/${o})`}),t.push({path:l.join(f.app.getAppPath(),"src","assets",o),description:`Dev (src/assets/${o})`}));else{const e="dist";if(p.info("[asset-protocol] Production environment detected"),p.info(`[asset-protocol] Platform: ${process.platform}`),p.info(`[asset-protocol] process.resourcesPath: ${process.resourcesPath}`),p.info(`[asset-protocol] app.getAppPath(): ${f.app.getAppPath()}`),p.info(`[asset-protocol] app.getPath('exe'): ${f.app.getPath("exe")}`),p.info(`[asset-protocol] requestedAssetPath: "${o}"`),process.platform==="win32"){if(o.startsWith("assets/"))t.push({path:l.join(process.resourcesPath,o),description:"Windows Direct Resources (with assets/ prefix)"}),t.push({path:l.join(process.resourcesPath,"app.asar.unpacked",o),description:"Windows Unpacked ASAR (with assets/ prefix)"});else{const d=`assets/${o}`;t.push({path:l.join(process.resourcesPath,d),description:"Windows Direct Resources (added assets/ prefix)"}),t.push({path:l.join(process.resourcesPath,"app.asar.unpacked",d),description:"Windows Unpacked ASAR (added assets/ prefix)"})}t.push({path:l.join(process.resourcesPath,"app.asar.unpacked",o),description:"Windows Unpacked ASAR (original path)"}),t.push({path:l.join(process.resourcesPath,o),description:"Windows Direct Resources (original path)"}),t.push({path:l.join(process.resourcesPath,"app.asar",e,o),description:"Windows ASAR dist"}),t.push({path:l.join(process.resourcesPath,"app.asar",o),description:"Windows ASAR"});const n=f.app.getPath("exe"),a=l.normalize(n);p.debug(`[asset-protocol] Windows Exe directory: ${n} -> ${a}`);const u=l.normalize(l.join(n,".."));o.startsWith("assets/")?(t.push({path:l.join(u,"resources",o),description:"Windows Exe Resources (with assets/ prefix)"}),t.push({path:l.join(u,"resources",o.substring(7)),description:"Windows Exe Resources (no assets/ prefix)"}),t.push({path:l.join(u,o),description:"Windows Exe Parent (with assets/ prefix)"})):(t.push({path:l.join(u,"resources","assets",o),description:"Windows Exe Resources (added assets/ prefix)"}),t.push({path:l.join(u,"resources",o),description:"Windows Exe Resources (no assets/ prefix)"}),t.push({path:l.join(u,"assets",o),description:"Windows Exe Parent (added assets/ prefix)"}))}else{const n=[l.join(process.resourcesPath,"app.asar",e),l.join(process.resourcesPath,"app.asar")],a=[l.join(process.resourcesPath,"app.asar.unpacked",e),l.join(process.resourcesPath,"app.asar.unpacked")],u=process.resourcesPath;for(const d of n)t.push({path:l.join(d,o),description:`ASAR (${d})`});for(const d of a)t.push({path:l.join(d,o),description:`Unpacked (${d})`});t.push({path:l.join(u,o),description:"Direct Resources"}),o.startsWith("assets/")&&t.push({path:l.join(u,o.substring(7)),description:"Direct Resources (no 'assets/' prefix)"})}}let r;for(const e of t){const n=l.normalize(e.path);p.info(`[asset-protocol] Checking (${e.description}): "${e.path}" -> "${n}"`);let a=!1;try{if(a=m.existsSync(n),!a&&process.platform==="win32"){const u=n.toLowerCase(),d=n.toUpperCase();a=m.existsSync(u)||m.existsSync(d),a&&p.debug(`[asset-protocol] Found with case-insensitive check: ${n}`)}}catch(u){p.warn(`[asset-protocol] Error checking path existence: ${n}`,u)}if(a){r=n,p.info(`[asset-protocol] SUCCESS: Asset found at "${r}"`);break}else p.warn(`[asset-protocol] FAILED: Asset not found at "${n}"`)}r?(p.info(`[asset-protocol] Calling callback with resolved path: "${r}"`),h&&!h.isDestroyed()&&h.webContents.send("main-process-log",{level:"info",message:`[asset-protocol] パス解決成功: ${o} -> ${r}`}),s({path:r})):(p.error(`[asset-protocol] ERROR: Could not resolve asset for requestedAssetPath: "${o}". All checks failed.`),p.error(`[asset-protocol] Tried ${t.length} paths:`),t.forEach((e,n)=>{const a=l.normalize(e.path);p.error(`[asset-protocol]   ${n+1}. ${e.description}: "${e.path}" -> "${a}"`)}),h&&!h.isDestroyed()&&h.webContents.send("main-process-log",{level:"error",message:`[asset-protocol] パス解決失敗: ${o}`,details:t.map((e,n)=>{const a=l.normalize(e.path);return`${n+1}. ${e.description}: "${e.path}" -> "${a}"`})}),s({error:-6})),p.info("[asset-protocol] --------------- Request End ---------------")}catch(i){p.error("[asset-protocol] Unexpected error in protocol handler:",i),s({error:-2}),p.info("[asset-protocol] --------------- Request End (Error) ---------------")}})),f.app.isPackaged&&p.info("Auto-update is disabled in production");const h=await Et();process.on("uncaughtException",c=>{p.error("Uncaught exception:",c),f.app.exit(1)}),process.on("unhandledRejection",c=>{p.error("Unhandled rejection:",c),f.app.exit(1)})}catch(h){p.error("Error in app ready handler:",h),f.app.exit(1)}});f.app.on("window-all-closed",()=>{p.info("All windows closed, quitting application"),f.app.quit()});
